{% extends "base.html" %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-md-5 col-lg-4">
    <div class="d-flex justify-content-between align-items-center mb-4 no-print gap-3">
      <a href="{{ url_for('new_sale') }}" class="btn btn-outline-secondary d-flex align-items-center gap-2">
        <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path d="M19 12H5" />
          <path d="M12 19l-7-7 7-7" />
        </svg>
        New Sale
      </a>
      <button onclick="window.print()" class="btn btn-danger d-flex align-items-center gap-2 shadow-lg">
        <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <polyline points="6 9 6 2 18 2 18 9" />
          <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2" />
          <rect x="6" y="14" width="12" height="8" />
        </svg>
        Print Receipt
      </button>
    </div>

    <div class="card border-0 shadow-lg position-relative overflow-hidden receipt-card">
      <!-- Jagged edge visual top -->
      <div class="receipt-edge top"></div>

      <div class="card-body p-4 bg-white text-dark font-monospace">
        <div class="text-center mb-4">
          <h5 class="fw-bold text-uppercase letter-spacing-2 mb-1">Prime Cuts</h5>
          <p class="small text-muted mb-0">Premium Butcher Shop</p>
          <p class="small text-muted">123 Market Street, Nairobi</p>
        </div>

        <div class="border-top border-bottom border-dashed py-2 mb-3 small">
          <div class="d-flex justify-content-between">
            <span>Receipt #:</span>
            <span class="fw-bold">{{ "%06d"|format(sale.id) }}</span>
          </div>
          <div class="d-flex justify-content-between">
            <span>Date:</span>
            <span>{{ sale.sale_datetime }}</span>
          </div>
          <div class="d-flex justify-content-between">
            <span>Cashier:</span>
            <span>{{ sale.username }}</span>
          </div>
        </div>

        <table class="table table-borderless table-sm small mb-3">
          <thead>
            <tr class="text-uppercase border-bottom">
              <th class="ps-0">Item</th>
              <th class="text-end">Qty</th>
              <th class="text-end pe-0">Total</th>
            </tr>
          </thead>
          <tbody>
            {% for item in items %}
            <tr>
              <td class="ps-0">{{ item.name }}</td>
              <td class="text-end">{{ "%.1f"|format(item.quantity) }}</td>
              <td class="text-end pe-0">{{ "%.2f"|format(item.line_total) }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>

        <div class="border-top border-dark pt-2 mb-4">
          <div class="d-flex justify-content-between fw-bold fs-5">
            <span>TOTAL</span>
            <span>KES {{ "%.2f"|format(sale.total_amount) }}</span>
          </div>
          <div class="d-flex justify-content-between small text-muted mt-1">
            <span>Cash</span>
            <span>KES {{ "%.2f"|format(sale.total_amount) }}</span>
          </div>
        </div>

        <div class="text-center small text-muted mt-4">
          <p class="mb-1">*** Thank You! ***</p>
          <p class="mb-0">Please come again.</p>
          <div class="mt-3">
            <svg width="100%" height="40" preserveAspectRatio="none">
              <rect x="0" y="0" width="100%" height="100%" fill="url(#opac)" />
              <defs>
                <pattern id="opac" patternUnits="userSpaceOnUse" width="4" height="4">
                  <path d="M0 4L4 0M-1 1L1 -1M3 5L5 3" stroke="#000" stroke-width="1" opacity="0.3" />
                </pattern>
              </defs>
            </svg>
          </div>
        </div>
      </div>

      <!-- Jagged edge visual bottom -->
      <div class="receipt-edge bottom"></div>
    </div>
  </div>
</div>

<style>
  /* Receipt Specific Styles */
  .font-monospace {
    font-family: 'Courier New', Courier, monospace !important;
  }

  .border-dashed {
    border-style: dashed !important;
  }

  .letter-spacing-2 {
    letter-spacing: 2px;
  }

  .receipt-card {
    background: #fff;
    color: #000;
  }

  .receipt-edge {
    position: absolute;
    left: 0;
    right: 0;
    height: 12px;
    background-size: 20px 20px;
    background-repeat: repeat-x;
  }

  .top {
    top: -6px;
    background: radial-gradient(circle, transparent 50%, #fff 50%);
    background-size: 12px 12px;
  }

  .bottom {
    bottom: -6px;
    background: radial-gradient(circle, transparent 50%, #fff 50%);
    background-size: 12px 12px;
    transform: rotate(180deg);
  }

  /* Print Optimization */
  @media print {

    body,
    html {
      background: white !important;
    }

    .receipt-card {
      box-shadow: none !important;
      border: none !important;
      width: 100% !important;
      max-width: 80mm !important;
      margin: 0 auto;
    }

    .no-print {
      display: none !important;
    }
  }
</style>
{% endblock %}