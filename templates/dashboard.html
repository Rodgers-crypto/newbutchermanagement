{% extends "base.html" %}

{% block content %}
<div class="row g-3 mb-4">
  <!-- Compact Header -->
  <div class="col-12 d-flex justify-content-between align-items-center">
    <h4 class="mb-0 fw-bold">Dashboard</h4>
    <div class="text-muted small">Today: {{ current_year }}</div>
  </div>

  <!-- Stats Row - Clean Cards, No Gradients -->
  <div class="col-md-6 col-lg-4">
    <div class="card h-100 border p-3">
      <div class="d-flex align-items-center justify-content-between mb-2">
        <span class="text-uppercase small fw-bold text-muted">Today's Revenue</span>
        <span class="d-inline-flex align-items-center justify-content-center bg-surface-hover rounded-circle"
          style="width: 32px; height: 32px;">
          <svg width="16" height="16" class="text-success" fill="none" stroke="currentColor" stroke-width="2"
            viewBox="0 0 24 24">
            <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" />
          </svg>
        </span>
      </div>
      <h3 class="fw-bold mb-0">KES {{ "%.2f"|format(total_sales) }}</h3>
      <div class="small text-muted mt-1">Live sales tracking</div>
    </div>
  </div>

  <div class="col-md-6 col-lg-8">
    <div class="card h-100 border p-3">
      <div class="d-flex align-items-center justify-content-between mb-3">
        <span class="text-uppercase small fw-bold text-muted">Quick Actions</span>
      </div>
      <div class="d-flex gap-2">
        <a href="{{ url_for('new_sale') }}" class="btn btn-danger d-flex align-items-center gap-2">
          <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path d="M12 5v14M5 12h14" />
          </svg>
          New Sale
        </a>
        <a href="{{ url_for('reports') }}" class="btn btn-outline-secondary d-flex align-items-center gap-2">
          <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <line x1="18" y1="20" x2="18" y2="10" />
            <line x1="12" y1="20" x2="12" y2="4" />
            <line x1="6" y1="20" x2="6" y2="14" />
          </svg>
          Reports
        </a>
        {% if g.user.role == 'admin' %}
        <a href="{{ url_for('inventory_list') }}" class="btn btn-outline-secondary d-flex align-items-center gap-2">
          <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path d="M20 12v6a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-6" />
            <path d="M9 12V6a3 3 0 0 1 6 0v6" />
          </svg>
          Inventory
        </a>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<div class="card border mb-4">
  <div class="card-header bg-transparent d-flex justify-content-between align-items-center py-2">
    <span class="fw-bold fs-6">Low Stock Alerts</span>
    {% if low_stock_items %}
    <span class="badge bg-warning text-dark">{{ low_stock_items|length }} items</span>
    {% endif %}
  </div>
  <div class="table-responsive">
    {% if low_stock_items %}
    <table class="table table-hover table-sm">
      <thead class="bg-surface-hover">
        <tr>
          <th class="ps-3 border-0">Item Name</th>
          <th class="text-end border-0">Current Stock</th>
          <th class="text-end pe-3 border-0">Status</th>
        </tr>
      </thead>
      <tbody>
        {% for item in low_stock_items %}
        <tr>
          <td class="ps-3 fw-medium">{{ item.name }}</td>
          <td class="text-end font-monospace">{{ "%.2f"|format(item.stock_quantity) }}</td>
          <td class="text-end pe-3">
            {% if item.stock_quantity <= 5 %} <span class="text-danger fw-bold small">CRITICAL</span>
              {% else %}
              <span class="text-warning fw-bold small">LOW</span>
              {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% else %}
    <div class="p-4 text-center text-muted small">
      All inventory levels are healthy.
    </div>
    {% endif %}
  </div>
</div>

<style>
  /* Local overrides for compact feel */
  .bg-surface-hover {
    background-color: #272727;
  }
</style>
{% endblock %}