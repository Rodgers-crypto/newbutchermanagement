{% extends "base.html" %}

{% block content %}
<div class="row mb-4 animate-fade-in">
  <div class="col-md-12 mb-4">
    <h2 class="fw-bold mb-0">Dashboard</h2>
    <p class="text-muted">Overview of today's performance</p>
  </div>

  <!-- Stats Cards -->
  <div class="col-md-6 mb-4">
    <div class="card h-100 border-0 bg-gradient-dark position-relative overflow-hidden">
      <div class="card-body p-4 position-relative z-1">
        <div class="d-flex align-items-center justify-content-between mb-3">
          <h6 class="text-uppercase text-white-50 fw-bold letter-spacing-1 mb-0">Today's Revenue</h6>
          <div class="p-2 bg-white-10 rounded-circle text-white">
            <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round">
              <line x1="12" y1="1" x2="12" y2="23" />
              <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" />
            </svg>
          </div>
        </div>
        <h1 class="display-4 fw-bold text-white mb-0">KES {{ "%.2f"|format(total_sales) }}</h1>
        <div class="mt-2 text-white-50 small">
          <span class="text-success fw-bold">
            <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <polyline points="23 6 13.5 15.5 8.5 10.5 1 18" />
              <polyline points="17 6 23 6 23 12" />
            </svg>
            Live
          </span>
          tracking for today
        </div>
      </div>
      <!-- decorative background glow -->
      <div class="position-absolute top-0 end-0 w-50 h-100 bg-danger opacity-10 blur-xl"></div>
    </div>
  </div>

  <div class="col-md-6 mb-4">
    <div class="card h-100">
      <div class="card-header bg-transparent border-0 pt-4 pb-0">
        <h6 class="text-uppercase text-muted fw-bold letter-spacing-1 mb-0">Quick Actions</h6>
      </div>
      <div class="card-body d-flex flex-wrap gap-3 align-items-center">
        <a href="{{ url_for('new_sale') }}" class="btn btn-danger btn-lg flex-grow-1 py-3">
          <svg width="20" height="20" class="me-2" fill="none" stroke="currentColor" stroke-width="2"
            viewBox="0 0 24 24">
            <rect x="1" y="4" width="22" height="16" rx="2" ry="2" />
            <line x1="1" y1="10" x2="23" y2="10" />
          </svg>
          New Sale
        </a>
        <a href="{{ url_for('reports') }}" class="btn btn-outline-secondary btn-lg flex-grow-1 py-3">
          <svg width="20" height="20" class="me-2" fill="none" stroke="currentColor" stroke-width="2"
            viewBox="0 0 24 24">
            <line x1="18" y1="20" x2="18" y2="10" />
            <line x1="12" y1="20" x2="12" y2="4" />
            <line x1="6" y1="20" x2="6" y2="14" />
          </svg>
          Reports
        </a>
        {% if g.user.role == 'admin' %}
        <a href="{{ url_for('inventory_list') }}" class="btn btn-outline-secondary btn-lg w-100 py-3">
          <svg width="20" height="20" class="me-2" fill="none" stroke="currentColor" stroke-width="2"
            viewBox="0 0 24 24">
            <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z" />
            <line x1="3" y1="6" x2="21" y2="6" />
            <path d="M16 10a4 4 0 0 1-8 0" />
          </svg>
          Manage Inventory
        </a>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<div class="row">
  <div class="col-12">
    <div class="card">
      <div class="card-header d-flex justify-content-between align-items-center">
        <span class="fw-bold">
          <svg width="18" height="18" class="me-2 text-warning" fill="none" stroke="currentColor" stroke-width="2"
            viewBox="0 0 24 24">
            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z" />
            <line x1="12" y1="9" x2="12" y2="13" />
            <line x1="12" y1="17" x2="12.01" y2="17" />
          </svg>
          Low Stock Alerts
        </span>
        {% if low_stock_items %}
        <span class="badge bg-warning text-dark">{{ low_stock_items|length }} items</span>
        {% endif %}
      </div>
      <div class="card-body p-0">
        {% if low_stock_items %}
        <div class="table-responsive">
          <table class="table table-hover align-middle mb-0">
            <thead class="table-light">
              <tr>
                <th class="ps-4">Item Name</th>
                <th class="text-end pe-4">Current Stock</th>
                <th class="text-end pe-4">Status</th>
              </tr>
            </thead>
            <tbody>
              {% for item in low_stock_items %}
              <tr>
                <td class="ps-4 fw-medium">{{ item.name }}</td>
                <td class="text-end pe-4 font-monospace fs-6">
                  {{ "%.2f"|format(item.stock_quantity) }}
                </td>
                <td class="text-end pe-4">
                  {% if item.stock_quantity <= 5 %} <span
                    class="badge bg-danger-subtle text-danger border border-danger-subtle">Critical</span>
                    {% else %}
                    <span class="badge bg-warning-subtle text-warning border border-warning-subtle">Low</span>
                    {% endif %}
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        {% else %}
        <div class="p-5 text-center text-muted">
          <svg width="48" height="48" class="mb-3 opacity-25" fill="none" stroke="currentColor" stroke-width="1.5"
            viewBox="0 0 24 24">
            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
            <polyline points="22 4 12 14.01 9 11.01" />
          </svg>
          <p class="mb-0">Inventory levels are healthy.</p>
        </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<style>
  .bg-white-10 {
    background: rgba(255, 255, 255, 0.1);
  }

  .blur-xl {
    filter: blur(60px);
  }

  .letter-spacing-1 {
    letter-spacing: 1px;
  }

  .bg-gradient-dark {
    background: linear-gradient(135deg, #18181b 0%, #27272a 100%);
  }
</style>
{% endblock %}